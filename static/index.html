<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datadog AI Notebook Generator | Modern Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" href="/static/images/datadog-logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <meta name="description" content="Generate AI-powered Datadog notebooks and dashboards with advanced monitoring capabilities">
    <meta name="theme-color" content="#632ca6">
</head>
<body>
    <div class="app-container">
        <!-- Enhanced Side Navigation Panel -->
        <nav class="side-nav" id="sideNav">
            <div class="side-nav-header">
                <div class="side-nav-logo">
                    <img src="/static/images/datadog-logo.png" alt="Datadog" class="side-nav-logo-icon">
                    <span class="side-nav-logo-text">Datadog AI</span>
                </div>
                <button class="side-nav-toggle" id="sideNavToggle" aria-label="Toggle navigation">
                    <span class="toggle-icon">‚Äπ</span>
                </button>
            </div>
            
            <div class="side-nav-content">
                <!-- Quick Search -->
                <div class="side-nav-item">
                    <div class="side-nav-link" onclick="openQuickSearch()">
                        <span class="side-nav-icon">üîç</span>
                        <span class="side-nav-text">Quick Search</span>
                        <span class="side-nav-shortcut">‚åòK</span>
                    </div>
                </div>
                
                <div class="side-nav-divider"></div>
                
                <!-- Main Navigation -->
                <div class="side-nav-section">
                    <div class="side-nav-item active">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">ü§ñ</span>
                            <span class="side-nav-text">AI Generator</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üìä</span>
                            <span class="side-nav-text">Dashboards</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üìì</span>
                            <span class="side-nav-text">Notebooks</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üìà</span>
                            <span class="side-nav-text">Metrics Explorer</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üñ•Ô∏è</span>
                            <span class="side-nav-text">Infrastructure</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üîç</span>
                            <span class="side-nav-text">APM</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üìù</span>
                            <span class="side-nav-text">Log Analytics</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üõ°Ô∏è</span>
                            <span class="side-nav-text">Security</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">ü§ñ</span>
                            <span class="side-nav-text">Synthetics</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üì±</span>
                            <span class="side-nav-text">RUM</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üöÄ</span>
                            <span class="side-nav-text">CI/CD</span>
                        </div>
                    </div>
                    
                    <div class="side-nav-item jett-special">
                        <div class="side-nav-link" onclick="window.open('/typeracer', '_blank')">
                            <span class="side-nav-icon">‚ö°</span>
                            <span class="side-nav-text">Jett TypeRacer</span>
                            <span class="jett-badge">LIVE</span>
                        </div>
                    </div>
                </div>
                
                <div class="side-nav-divider"></div>
                
                <!-- Recent Section -->
                <div class="side-nav-section">
                    <div class="side-nav-section-title">Recent</div>
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üìä</span>
                            <span class="side-nav-text">System Overview</span>
                        </div>
                    </div>
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üìì</span>
                            <span class="side-nav-text">Performance Analysis</span>
                        </div>
                    </div>
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üñ•Ô∏è</span>
                            <span class="side-nav-text">Host Map</span>
                        </div>
                    </div>
                </div>
                
                <div class="side-nav-divider"></div>
                
                <!-- Favorites Section -->
                <div class="side-nav-section">
                    <div class="side-nav-section-title">Favorites</div>
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">‚≠ê</span>
                            <span class="side-nav-text">My Dashboards</span>
                        </div>
                    </div>
                    <div class="side-nav-item">
                        <div class="side-nav-link">
                            <span class="side-nav-icon">üìå</span>
                            <span class="side-nav-text">Pinned Metrics</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="side-nav-footer">
                <div class="side-nav-item">
                    <div class="side-nav-link">
                        <span class="side-nav-icon">‚öôÔ∏è</span>
                        <span class="side-nav-text">Settings</span>
                    </div>
                </div>
                <div class="side-nav-item">
                    <div class="side-nav-link">
                        <span class="side-nav-icon">‚ùì</span>
                        <span class="side-nav-text">Help & Support</span>
                    </div>
                </div>
                <div class="side-nav-item">
                    <div class="side-nav-link">
                        <span class="side-nav-icon">üåô</span>
                        <span class="side-nav-text">Dark Mode</span>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main App Content -->
        <div class="main-app-content">
            <!-- Enhanced Header -->
            <header class="header">
                <div class="header-content">
                                    <div class="logo">
                    <img src="/static/images/datadog-logo.png" alt="Datadog" class="logo-icon">
                    <div class="logo-text-container">
                        <h1>AI Notebook Generator</h1>
                        <div class="jett-subtitle">// Ï†úÌä∏ ÏãúÏä§ÌÖú Ïò®ÎùºÏù∏ //</div>
                    </div>
                </div>
                    <div class="header-info">
                        <div class="status-indicator" id="statusIndicator">
                            <span class="status-dot" id="statusDot"></span>
                            <span class="status-text" id="statusText">Checking...</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="main-content">
                <!-- üåü CYBERPUNK WELCOME SECTION -->
                <section class="welcome-section fade-in">
                    <div class="welcome-header">
                        <h2>‚ö° AI-POWERED DATADOG GENERATOR ‚ö°</h2>
                        <div class="welcome-subtitle">// JETT NEURAL INTERFACE ACTIVE //</div>
                    </div>
                    <div class="welcome-grid">
                        <div class="welcome-feature">
                            <span class="feature-icon">ü§ñ</span>
                            <h3>Neural AI Processing</h3>
                            <p>Advanced machine learning algorithms transform your monitoring requirements into comprehensive analysis tools</p>
                        </div>
                        <div class="welcome-feature">
                            <span class="feature-icon">‚ö°</span>
                            <h3>Quantum Speed Generation</h3>
                            <p>Instant dashboard and notebook creation with real-time data processing and predictive insights</p>
                        </div>
                        <div class="welcome-feature">
                            <span class="feature-icon">üéØ</span>
                            <h3>Precision Targeting</h3>
                            <p>Jett-level accuracy in metric selection and visualization optimization for maximum operational impact</p>
                        </div>
                    </div>
                    <div class="cyber-divider"></div>
                </section>

                <!-- Enhanced Metrics Info Section -->
                <section class="metrics-info-section slide-up">
                    <div class="metrics-info-container">
                        <div class="metrics-summary" id="metricsSummary">
                            <div class="metrics-stat">
                                <span class="stat-number" id="totalMetrics">-</span>
                                <span class="stat-label">Live Metrics</span>
                            </div>
                            <div class="metrics-stat">
                                <span class="stat-number" id="totalIntegrations">-</span>
                                <span class="stat-label">Integrations</span>
                            </div>
                            <div class="metrics-stat">
                                <span class="stat-number" id="totalGenerated">0</span>
                                <span class="stat-label">Generated Today</span>
                            </div>
                            <div class="metrics-integrations" id="integrationsDisplay">
                                <span class="integrations-label">üîó Connected Integrations:</span>
                                <span class="integrations-list" id="integrationsList">Loading...</span>
                            </div>
                        </div>
                        <div class="suggested-metrics" id="suggestedMetrics" style="display: none;">
                            <h4>üí° AI-Suggested Metrics for Your Request:</h4>
                            <div class="metrics-list" id="metricsList"></div>
                        </div>
                    </div>
                </section>

                <!-- Enhanced Generator Form -->
                <section class="generator-section">
                    <div class="form-container slide-up">
                        <form id="notebookForm" class="notebook-form">
                            <!-- Generation Mode Selection -->
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="label-text">üéØ Choose Your Creation Mode</span>
                                    <span class="label-hint">Select what type of monitoring asset you want to create</span>
                                </label>
                                <div class="mode-selector">
                                    <input type="radio" id="modeNotebook" name="generationMode" value="notebook" class="mode-radio" checked>
                                    <label for="modeNotebook" class="mode-label">
                                        <span class="mode-icon">üìì</span>
                                        <span class="mode-text">AI Notebook</span>
                                        <span class="mode-desc">Interactive analysis with cells and documentation</span>
                                    </label>
                                    
                                    <input type="radio" id="modeDashboard" name="generationMode" value="dashboard" class="mode-radio">
                                    <label for="modeDashboard" class="mode-label">
                                        <span class="mode-icon">üìä</span>
                                        <span class="mode-text">Smart Dashboard</span>
                                        <span class="mode-desc">Visual widgets, charts, and real-time monitoring</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Enhanced Description Input -->
                            <div class="form-group">
                                <label for="description" class="form-label">
                                    <span class="label-text" id="descriptionLabel">ü§ñ Describe Your Monitoring Needs</span>
                                    <span class="label-hint" id="descriptionHint">Be specific about metrics, timeframes, and analysis goals. Our AI will optimize the output for you.</span>
                                </label>
                                <textarea 
                                    id="description" 
                                    name="description" 
                                    class="form-textarea"
                                    placeholder="Example: Create a comprehensive monitoring notebook for our e-commerce platform showing CPU and memory usage patterns for web servers over the last 24 hours, including error rates, response times, and database performance metrics to help troubleshoot recent performance degradation..."
                                    required
                                    rows="5"
                                    maxlength="2000"
                                ></textarea>
                                <div class="character-counter">
                                    <span id="charCount">0</span>/2000 characters
                                </div>
                            </div>

                            <!-- Enhanced Advanced Settings -->
                            <div class="advanced-settings">
                                <h4 class="settings-title">
                                    <span>‚öôÔ∏è Advanced Configuration</span>
                                    <span class="optional">(optional)</span>
                                </h4>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="metricNames" class="form-label">
                                            <span class="label-text">üìä Specific Metrics</span>
                                            <span class="label-hint">Comma-separated list of exact metric names to include</span>
                                        </label>
                                        <input 
                                            type="text" 
                                            id="metricNames" 
                                            name="metricNames" 
                                            class="form-input"
                                            placeholder="e.g., system.cpu.user, system.mem.used, aws.ec2.cpu_utilization"
                                        >
                                    </div>

                                    <div class="form-group">
                                        <label for="timeframes" class="form-label">
                                            <span class="label-text">‚è∞ Time Range</span>
                                            <span class="label-hint">Analysis timeframe</span>
                                        </label>
                                        <select id="timeframes" name="timeframes" class="form-select">
                                            <option value="">ü§ñ AI Auto-select</option>
                                            <option value="15m">‚ö° Last 15 minutes</option>
                                            <option value="1h">üïê Last 1 hour</option>
                                            <option value="4h">üïì Last 4 hours</option>
                                            <option value="1d">üìÖ Last 24 hours</option>
                                            <option value="3d">üìä Last 3 days</option>
                                            <option value="1w">üìà Last week</option>
                                            <option value="1m">üìÜ Last month</option>
                                            <option value="3m">üìã Last 3 months</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="spaceAggregation" class="form-label">
                                            <span class="label-text">üî¢ Data Aggregation</span>
                                            <span class="label-hint">How to combine data points across hosts/services</span>
                                        </label>
                                        <select id="spaceAggregation" name="spaceAggregation" class="form-select">
                                            <option value="">ü§ñ Smart Selection</option>
                                            <option value="avg">üìä Average (avg)</option>
                                            <option value="sum">‚ûï Sum (sum)</option>
                                            <option value="min">‚¨áÔ∏è Minimum (min)</option>
                                            <option value="max">‚¨ÜÔ∏è Maximum (max)</option>
                                            <option value="count">üî¢ Count (count)</option>
                                            <option value="rate">üìà Rate (rate)</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="rollup" class="form-label">
                                            <span class="label-text">üìè Data Resolution</span>
                                            <span class="label-hint">Time interval between data points</span>
                                        </label>
                                        <select id="rollup" name="rollup" class="form-select">
                                            <option value="">üéØ Optimal Resolution</option>
                                            <option value="1m">‚ö° 1 minute</option>
                                            <option value="5m">üïê 5 minutes</option>
                                            <option value="15m">üïí 15 minutes</option>
                                            <option value="1h">üïì 1 hour</option>
                                            <option value="4h">üïó 4 hours</option>
                                            <option value="1d">üìÖ 1 day</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Deployment Option -->
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="createInDatadog" name="createInDatadog" class="form-checkbox">
                                    <label for="createInDatadog" class="checkbox-label">
                                        <span class="checkbox-text" id="createInDatadogText">üöÄ Deploy directly to Datadog</span>
                                        <span class="checkbox-hint">Automatically create and deploy to your Datadog environment (requires valid API credentials)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Enhanced Action Buttons -->
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary" id="generateBtn">
                                    <span class="btn-icon">üöÄ</span>
                                    <span id="generateBtnText">Generate with AI</span>
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="clearForm()">
                                    <span class="btn-icon">üîÑ</span>
                                    Reset Form
                                </button>
                                <button type="button" class="btn btn-outline" onclick="loadExample()">
                                    <span class="btn-icon">üí°</span>
                                    Load Example
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Enhanced Results Section -->
                <section class="results-section" id="resultsSection" style="display: none;">
                    <div class="results-container slide-up">
                        <div class="results-header">
                            <h3>üéâ Generated Content</h3>
                            <div class="results-actions">
                                <button class="btn btn-small btn-outline" onclick="downloadJSON()">
                                    <span class="btn-icon">üì•</span>
                                    Download JSON
                                </button>
                                <button class="btn btn-small btn-outline" onclick="copyToClipboard()">
                                    <span class="btn-icon">üìã</span>
                                    Copy JSON
                                </button>
                                <button class="btn btn-small btn-primary" onclick="openInDatadog()" id="openInDatadogBtn" style="display: none;">
                                    <span class="btn-icon">üîó</span>
                                    Open in Datadog
                                </button>
                            </div>
                        </div>

                        <div class="results-content">
                            <!-- Enhanced Tab Container -->
                            <div class="tab-container">
                                <div class="tab-nav">
                                    <button class="tab-btn active" onclick="showTab('preview')">
                                        <span>üìä</span>
                                        Preview
                                    </button>
                                    <button class="tab-btn" onclick="showTab('json')">
                                        <span>üìÑ</span>
                                        JSON Structure
                                    </button>
                                    <button class="tab-btn" onclick="showTab('details')">
                                        <span>‚ÑπÔ∏è</span>
                                        AI Analysis
                                    </button>
                                    <button class="tab-btn" onclick="showTab('metrics')">
                                        <span>üìà</span>
                                        Metrics Used
                                    </button>
                                    <button class="tab-btn" onclick="showTab('analysis')">
                                        <span>üîç</span>
                                        Metric Analysis
                                    </button>
                                </div>

                                <div class="tab-content">
                                    <div id="previewTab" class="tab-pane active">
                                        <div class="preview-content" id="previewContent">
                                            <!-- Preview content will be inserted here -->
                                        </div>
                                    </div>

                                    <div id="jsonTab" class="tab-pane">
                                        <div class="json-container">
                                            <pre id="jsonContent" class="json-content"></pre>
                                        </div>
                                    </div>

                                    <div id="detailsTab" class="tab-pane">
                                        <div class="details-content" id="detailsContent">
                                            <!-- AI analysis details will be inserted here -->
                                        </div>
                                    </div>

                                    <div id="metricsTab" class="tab-pane">
                                        <div class="metrics-content" id="metricsContent">
                                            <!-- Metrics breakdown will be inserted here -->
                                        </div>
                                    </div>

                                    <div id="analysisTab" class="tab-pane">
                                        <div class="analysis-content" id="analysisContent">
                                            <!-- Metric analysis will be inserted here -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Success/Error Messages -->
                            <div id="successMessage" class="message success" style="display: none;">
                                <div class="message-icon">üéâ</div>
                                <div class="message-content">
                                    <strong>Success! Your content has been generated.</strong>
                                    <p id="successDetails"></p>
                                </div>
                            </div>

                            <div id="errorMessage" class="message error" style="display: none;">
                                <div class="message-icon">‚ùå</div>
                                <div class="message-content">
                                    <strong>Oops! Something went wrong.</strong>
                                    <p id="errorDetails"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Live Notebook Preview Section -->
    <section class="live-preview-section" id="livePreviewSection" style="display: none;">
        <div class="preview-container">
            <div class="preview-header">
                <h3>üìì Live Notebook Preview</h3>
                <div class="preview-controls">
                    <button class="btn btn-small btn-outline" onclick="togglePreviewMode()">
                        <span class="btn-icon">üëÅÔ∏è</span>
                        <span id="previewModeText">Switch to Edit Mode</span>
                    </button>
                    <button class="btn btn-small btn-outline" onclick="refreshPreview()">
                        <span class="btn-icon">üîÑ</span>
                        Refresh Preview
                    </button>
                    <button class="btn btn-small btn-primary" onclick="savePreviewChanges()">
                        <span class="btn-icon">üíæ</span>
                        Save Changes
                    </button>
                    <button class="btn btn-small btn-secondary" onclick="closeLivePreview()">
                        <span class="btn-icon">‚úï</span>
                        Close Preview
                    </button>
                </div>
            </div>
            
            <div class="preview-content-wrapper">
                <!-- Preview Sidebar -->
                <div class="preview-sidebar">
                    <div class="preview-outline">
                        <h4>üìã Notebook Structure</h4>
                        <div class="outline-list" id="notebookOutline">
                            <!-- Outline items will be populated dynamically -->
                        </div>
                    </div>
                    
                    <div class="preview-metadata">
                        <h4>üìä Metadata</h4>
                        <div class="metadata-item">
                            <span class="metadata-label">Title:</span>
                            <span class="metadata-value" id="previewTitle">-</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Cells:</span>
                            <span class="metadata-value" id="previewCellCount">-</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Type:</span>
                            <span class="metadata-value" id="previewType">-</span>
                        </div>
                        <div class="metadata-item">
                            <span class="metadata-label">Status:</span>
                            <span class="metadata-value status" id="previewStatus">Not Generated</span>
                        </div>
                    </div>

                    <div class="preview-actions">
                        <h4>‚ö° Quick Actions</h4>
                        <button class="action-btn" onclick="addTextCell()">
                            <span>üìù</span>
                            Add Text Cell
                        </button>
                        <button class="action-btn" onclick="addQueryCell()">
                            <span>üìä</span>
                            Add Query Cell
                        </button>
                        <button class="action-btn" onclick="addVisualizationCell()">
                            <span>üìà</span>
                            Add Visualization
                        </button>
                        <button class="action-btn" onclick="duplicateCell()">
                            <span>üìã</span>
                            Duplicate Selected
                        </button>
                    </div>
                </div>

                <!-- Main Preview Area -->
                <div class="preview-main">
                    <div class="preview-toolbar">
                        <div class="toolbar-section">
                            <span class="toolbar-label">View Mode:</span>
                            <div class="mode-toggle">
                                <button class="mode-btn active" data-mode="preview" onclick="setPreviewMode('preview')">
                                    <span>üëÅÔ∏è</span>
                                    Preview
                                </button>
                                <button class="mode-btn" data-mode="edit" onclick="setPreviewMode('edit')">
                                    <span>‚úèÔ∏è</span>
                                    Edit
                                </button>
                                <button class="mode-btn" data-mode="split" onclick="setPreviewMode('split')">
                                    <span>‚ö°</span>
                                    Split
                                </button>
                            </div>
                        </div>
                        
                        <div class="toolbar-section">
                            <span class="toolbar-label">Zoom:</span>
                            <div class="zoom-controls">
                                <button class="zoom-btn" onclick="adjustZoom(-0.1)">-</button>
                                <span class="zoom-level" id="zoomLevel">100%</span>
                                <button class="zoom-btn" onclick="adjustZoom(0.1)">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="preview-viewport" id="previewViewport">
                        <div class="notebook-preview" id="notebookPreview">
                            <!-- Preview Mode Content -->
                            <div class="preview-mode-content" id="previewModeContent">
                                <div class="empty-preview">
                                    <div class="empty-icon">üìì</div>
                                    <h4>No Notebook Generated Yet</h4>
                                    <p>Generate a notebook above to see the live preview here</p>
                                    <button class="btn btn-primary" onclick="scrollToGenerator()">
                                        <span class="btn-icon">üöÄ</span>
                                        Generate Notebook
                                    </button>
                                </div>
                            </div>

                            <!-- Edit Mode Content -->
                            <div class="edit-mode-content" id="editModeContent" style="display: none;">
                                <div class="cell-editor" id="cellEditor">
                                    <!-- Editable cells will be rendered here -->
                                </div>
                            </div>

                            <!-- Split Mode Content -->
                            <div class="split-mode-content" id="splitModeContent" style="display: none;">
                                <div class="split-left">
                                    <h5>üìù Editor</h5>
                                    <div class="split-editor" id="splitEditor"></div>
                                </div>
                                <div class="split-right">
                                    <h5>üëÅÔ∏è Preview</h5>
                                    <div class="split-preview" id="splitPreview"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Enhanced Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 id="loadingTitle">ü§ñ AI is Working...</h3>
            <p id="loadingMessage">Analyzing your requirements and generating optimized content...</p>
            <div class="loading-progress" id="loadingProgress" style="margin-top: 1rem;">
                <div class="progress-step active" id="step1">üìã Parsing requirements</div>
                <div class="progress-step" id="step2">üîç Finding optimal metrics</div>
                <div class="progress-step" id="step3">üèóÔ∏è Building structure</div>
                <div class="progress-step" id="step4">‚ú® Finalizing output</div>
            </div>
            
            <!-- Jett's TypeRacer Arena Embedded -->
            <div class="jett-typeracer-arena" style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(145deg, rgba(15, 15, 35, 0.95), rgba(26, 26, 46, 0.9)); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; max-width: 650px; margin: 2rem auto 0; position: relative; overflow: hidden; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);">
                <!-- Jett's Lightning Border -->
                <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #00d4ff, #ff6b9d, #00d4ff); background-size: 200% 100%; animation: borderGlow 2s linear infinite;"></div>
                
                <div class="jett-header" style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 8px;">
                        <span class="lightning" style="font-size: 1.2rem; animation: lightningFlicker 1.5s ease-in-out infinite alternate;">‚ö°</span>
                        <h4 style="color: #00d4ff; margin: 0; font-size: 1.1rem; font-family: 'Orbitron', monospace; font-weight: 900; text-shadow: 0 0 10px #00d4ff, 0 0 20px #00d4ff;">Jett's Speed Trial</h4>
                        <span class="lightning" style="font-size: 1.2rem; animation: lightningFlicker 1.5s ease-in-out infinite alternate;">‚ö°</span>
                    </div>
                    <p style="color: #ff6b9d; margin: 0; opacity: 0.9; font-size: 0.8rem; font-style: italic;">Lightning-fast precision while AI generates</p>
                </div>
                
                                <!-- Jett's Challenge Arena -->
                <div class="jett-challenge-container">
                    <!-- Challenge Label -->
                    <div class="jett-challenge-label" style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 12px; color: #ff6b9d; font-weight: 600; font-size: 0.9rem;">
                        <span class="lightning" style="animation: lightningFlicker 1.5s ease-in-out infinite alternate;">‚ö°</span>
                        <span>Jett's Challenge</span>
                        <span class="lightning" style="animation: lightningFlicker 1.5s ease-in-out infinite alternate;">‚ö°</span>
                    </div>
                    
                    <div class="modal-sentence-container">
                        <p id="modalSentence" class="modal-sentence">The quick brown fox jumps over the lazy dog.</p>
                    </div>
                    
                    <!-- Input Label -->
                    <div class="jett-input-label" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; color: #00d4ff; font-weight: 600; font-size: 0.8rem;">
                        <span class="speed-icon" style="animation: runningMan 0.8s ease-in-out infinite alternate;">üèÉ‚Äç‚ôÇÔ∏è</span>
                        <span>Show Jett your lightning precision!</span>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <input type="text" id="modalTypingInput" placeholder="Type at the speed of light..." class="modal-typing-input" autocomplete="off" spellcheck="false">
                    </div>
                    
                    <div class="modal-race-track">
                        <div class="modal-track"></div>
                        <div class="modal-car" id="modalCar">
                            <div class="modal-mazda-mx5">
                                <div class="modal-car-body">
                                    <div class="modal-windshield"></div>
                                    <div class="modal-wheel modal-front-wheel"></div>
                                    <div class="modal-wheel modal-rear-wheel"></div>
                                </div>
                            </div>
                            <div class="modal-driver-name" style="font-size: 0.6rem; color: white; background: rgba(0,0,0,0.7); padding: 2px 6px; border-radius: 8px; margin-top: 2px; font-weight: bold; white-space: nowrap; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">Jett's Mazda</div>
                        </div>
                    </div>
                    
                    <!-- Jett's Stats -->
                    <div class="jett-stats" style="display: flex; justify-content: space-between; align-items: center; gap: 15px; margin-bottom: 10px;">
                        <div class="jett-stat-item" style="display: flex; align-items: center; gap: 8px; background: linear-gradient(145deg, rgba(0, 212, 255, 0.1), rgba(255, 107, 157, 0.1)); border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px 12px; border-radius: 10px; backdrop-filter: blur(5px); transition: all 0.3s ease;">
                            <div class="jett-stat-icon" style="font-size: 1.2rem; animation: iconPulse 2s ease-in-out infinite;">‚ö°</div>
                            <div>
                                <div style="color: #ff6b9d; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Jett Speed</div>
                                <div style="color: #00d4ff; font-size: 1rem; font-weight: 700; font-family: 'Orbitron', monospace; text-shadow: 0 0 5px rgba(0, 212, 255, 0.5);"><span id="modalWpm">0</span> WPM</div>
                            </div>
                        </div>
                        
                        <div class="jett-stat-item" style="display: flex; align-items: center; gap: 8px; background: linear-gradient(145deg, rgba(0, 212, 255, 0.1), rgba(255, 107, 157, 0.1)); border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px 12px; border-radius: 10px; backdrop-filter: blur(5px); transition: all 0.3s ease;">
                            <div class="jett-stat-icon" style="font-size: 1.2rem; animation: iconPulse 2s ease-in-out infinite;">üéØ</div>
                            <div>
                                <div style="color: #ff6b9d; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Mission Progress</div>
                                <div style="color: #00d4ff; font-size: 1rem; font-weight: 700; font-family: 'Orbitron', monospace; text-shadow: 0 0 5px rgba(0, 212, 255, 0.5);"><span id="modalProgress">0%</span></div>
                            </div>
                        </div>
                        
                        <button onclick="resetModalTypeRacer()" class="jett-reset-btn" style="background: linear-gradient(145deg, #00d4ff, #0099cc); color: #0a0a1f; border: none; padding: 8px 12px; border-radius: 15px; font-size: 0.7rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 5px; box-shadow: 0 3px 10px rgba(0, 212, 255, 0.3); font-family: 'Exo 2', sans-serif;">
                            <span style="animation: flagWave 1s ease-in-out infinite alternate;">üèÅ</span>
                            Reset Trial
                        </button>
                    </div>
                    
                    <div id="modalCompletionMessage" class="jett-completion-message" style="display: none;">
                        <div class="jett-victory-content" style="position: relative; z-index: 2;">
                            <h4 style="margin-bottom: 8px; font-size: 1rem; font-family: 'Orbitron', monospace; color: #00d4ff; text-shadow: 0 0 10px #00d4ff, 0 0 20px #00d4ff; animation: victoryPulse 1s ease-in-out infinite alternate;">‚ö° JETT SPEED ACHIEVED! ‚ö°</h4>
                            <p style="color: #ff6b9d; font-size: 0.8rem; margin-bottom: 8px; font-weight: 300;">Lightning reflexes! You've mastered Jett's precision!</p>
                            <div style="margin: 8px 0; padding: 8px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1);">
                                <span style="color: #00d4ff; font-size: 0.9rem; font-weight: 700; font-family: 'Orbitron', monospace;">Final Speed: <span id="modalFinalWpm">0</span> WPM</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Jett's Cyberpunk TypeRacer CSS for Modal -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap');
        
        /* Jett's Cyberpunk Animations */
        @keyframes borderGlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        @keyframes lightningFlicker {
            0% { opacity: 1; text-shadow: 0 0 5px #ffff00; }
            100% { opacity: 0.7; text-shadow: 0 0 10px #ffff00, 0 0 15px #ffff00; }
        }
        
        @keyframes runningMan {
            0% { transform: translateX(0px); }
            100% { transform: translateX(3px); }
        }
        
        @keyframes trackGlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes victoryPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }
        
        @keyframes flagWave {
            0% { transform: rotate(-5deg); }
            100% { transform: rotate(5deg); }
        }
        
        @keyframes victoryRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Adapted TypeRacer styles for modal */
        .modal-sentence-container {
            background: linear-gradient(145deg, rgba(0, 212, 255, 0.1), rgba(255, 107, 157, 0.1));
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(5px);
        }
        
        .modal-sentence {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #ffffff;
            font-family: 'Exo 2', monospace;
            font-weight: 400;
            text-align: center;
            margin: 0;
        }
        
        .modal-typing-input {
            width: 100%;
            padding: 12px;
            font-size: 0.9rem;
            background: linear-gradient(145deg, rgba(15, 15, 35, 0.8), rgba(26, 26, 46, 0.8));
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            outline: none;
            color: #ffffff;
            font-family: 'Exo 2', monospace;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .modal-typing-input:focus {
            border-color: #00d4ff;
            box-shadow: 
                0 0 15px rgba(0, 212, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .modal-typing-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }
        
        .modal-race-track {
            background: linear-gradient(145deg, #0a0a1f, #1a1a3e);
            border: 2px solid rgba(0, 212, 255, 0.3);
            height: 60px;
            border-radius: 10px;
            position: relative;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 
                inset 0 2px 10px rgba(0, 0, 0, 0.3),
                0 5px 15px rgba(0, 212, 255, 0.2);
        }
        
        .modal-track {
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                #0a0a1f 0px,
                #0a0a1f 30px,
                #1a1a3e 30px,
                #1a1a3e 40px
            );
            position: relative;
        }
        
        .modal-track::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00d4ff, #ff6b9d, #00d4ff);
            background-size: 200% 100%;
            animation: trackGlow 2s linear infinite;
            transform: translateY(-50%);
            box-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
        }
        
        .modal-car {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            transition: left 0.3s ease;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .modal-mazda-mx5 {
            position: relative;
            width: 40px;
            height: 20px;
            margin: 3px 0;
        }
        
        .modal-car-body {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff6b9d, #e55189);
            border-radius: 6px 3px 3px 6px;
            box-shadow: 
                0 2px 6px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
            transform: perspective(80px) rotateX(10deg);
            animation: carHover 3s ease-in-out infinite alternate;
        }
        
        @keyframes carHover {
            0% { transform: perspective(80px) rotateX(10deg) translateY(0px); }
            100% { transform: perspective(80px) rotateX(10deg) translateY(-1px); }
        }
        
        .modal-windshield {
            position: absolute;
            top: 1px;
            left: 23px;
            width: 12px;
            height: 8px;
            background: linear-gradient(135deg, rgba(0,212,255,0.8), rgba(0,212,255,0.6));
            border-radius: 2px 1px 1px 1px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .modal-wheel {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #333, #111);
            border-radius: 50%;
            border: 1px solid #555;
            animation: wheelSpin 0.5s linear infinite;
        }
        
        @keyframes wheelSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal-front-wheel {
            top: 10px;
            left: 28px;
        }
        
        .modal-rear-wheel {
            top: 10px;
            left: 8px;
        }
        
        .modal-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
        }
        
        .modal-stat-value {
            color: #00d4ff;
            font-weight: 700;
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 5px rgba(0, 212, 255, 0.5);
        }
        
                 .jett-completion-message {
             text-align: center;
             margin-top: 15px;
             padding: 15px;
             background: linear-gradient(145deg, rgba(0, 212, 255, 0.2), rgba(255, 107, 157, 0.2));
             border: 2px solid #00d4ff;
             border-radius: 15px;
             backdrop-filter: blur(10px);
             position: relative;
             overflow: hidden;
             transition: all 0.3s ease;
         }
         
         .jett-completion-message::before {
             content: '';
             position: absolute;
             top: -50%;
             left: -50%;
             width: 200%;
             height: 200%;
             background: conic-gradient(transparent, rgba(0, 212, 255, 0.1), transparent);
             animation: victoryRotate 4s linear infinite;
         }
        
        .modal-completion-message h4 {
            color: #ff6b9d;
            margin: 0 0 5px 0;
            font-size: 0.9rem;
            font-family: 'Orbitron', monospace;
            text-shadow: 
                0 0 5px #ff6b9d,
                0 0 10px #ff6b9d;
            animation: victoryPulse 1s ease-in-out infinite alternate;
        }
        
        @keyframes victoryPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }
        
        .modal-completion-message p {
            color: #ffffff;
            margin: 0;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Character highlighting */
        .char {
            background-color: transparent;
            transition: background-color 0.1s ease;
        }
        
        .char.correct {
            background-color: #00b894;
            color: white;
        }
        
        .char.incorrect {
            background-color: #e17055;
            color: white;
        }
        
        .char.current {
            background-color: #74b9ff;
            color: white;
        }
        
        .modal-reset-btn {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.5);
            padding: 5px 10px;
            border-radius: 15px;
            color: #00d4ff;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Exo 2', sans-serif;
        }
        
                 .modal-reset-btn:hover {
             background: rgba(0, 212, 255, 0.3);
             transform: translateY(-1px);
             box-shadow: 0 3px 10px rgba(0, 212, 255, 0.3);
         }
         
         /* Jett's Interactive Effects */
         .jett-stat-item:hover {
             transform: translateY(-2px);
             box-shadow: 0 8px 20px rgba(0, 212, 255, 0.2);
         }
         
         .jett-reset-btn:hover {
             transform: translateY(-2px) scale(1.05);
             box-shadow: 0 8px 20px rgba(0, 212, 255, 0.5);
         }
         
         /* Enhanced Jett Arena Container */
         .jett-typeracer-arena {
             font-family: 'Exo 2', sans-serif;
         }
         
         .jett-typeracer-arena:before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
             background-size: 400% 400%;
             animation: gradientShift 8s ease infinite;
             opacity: 0.1;
             z-index: -1;
         }
         
         @keyframes gradientShift {
             0% { background-position: 0% 50%; }
             50% { background-position: 100% 50%; }
             100% { background-position: 0% 50%; }
         }
    </style>

    <!-- Enhanced JavaScript -->
    <script src="/static/js/app.js"></script>
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            checkSystemStatus();
            loadMetricsInfo();
            setupFormValidation();
            setupKeyboardShortcuts();
        });

        // Character counter for description
        document.getElementById('description').addEventListener('input', function() {
            const charCount = this.value.length;
            document.getElementById('charCount').textContent = charCount;
            
            if (charCount > 1800) {
                document.getElementById('charCount').style.color = '#ff5555';
            } else if (charCount > 1500) {
                document.getElementById('charCount').style.color = '#ffcc00';
            } else {
                document.getElementById('charCount').style.color = '#74818a';
            }
        });

        // Mode selector updates
        document.querySelectorAll('input[name="generationMode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const isNotebook = this.value === 'notebook';
                document.getElementById('descriptionLabel').textContent = 
                    isNotebook ? 'ü§ñ Describe Your Notebook Needs' : 'ü§ñ Describe Your Dashboard Needs';
                document.getElementById('descriptionHint').textContent = 
                    isNotebook ? 
                    'Be specific about metrics, timeframes, and analysis goals. Our AI will create an interactive notebook.' :
                    'Be specific about metrics, timeframes, and visualization preferences. Our AI will create a comprehensive dashboard.';
                document.getElementById('createInDatadogText').textContent = 
                    isNotebook ? 'üöÄ Deploy notebook directly to Datadog' : 'üöÄ Deploy dashboard directly to Datadog';
                document.getElementById('generateBtnText').textContent = 
                    isNotebook ? 'Generate AI Notebook' : 'Generate AI Dashboard';
            });
        });

        // Enhanced side navigation toggle
        document.getElementById('sideNavToggle').addEventListener('click', function() {
            const sideNav = document.getElementById('sideNav');
            sideNav.classList.toggle('collapsed');
            
            // Save preference
            localStorage.setItem('sideNavCollapsed', sideNav.classList.contains('collapsed'));
        });

        // Restore navigation state
        if (localStorage.getItem('sideNavCollapsed') === 'true') {
            document.getElementById('sideNav').classList.add('collapsed');
        }

        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Cmd/Ctrl + K for quick search
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault();
                    openQuickSearch();
                }
                
                // Cmd/Ctrl + Enter to submit form
                if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('generateBtn').click();
                }
                
                // Escape to close live preview
                if (e.key === 'Escape') {
                    closeLivePreview();
                }
            });
        }

        // Quick search functionality
        function openQuickSearch() {
            // Placeholder for quick search modal
            alert('üîç Quick Search coming soon! Use Cmd/Ctrl+K to access.');
        }

        // Load example functionality
        function loadExample() {
            const examples = [
                "Create a comprehensive performance monitoring notebook for our microservices architecture showing CPU, memory, and network metrics across all services over the last 4 hours, including error rates and response time percentiles to identify bottlenecks.",
                "Build a dashboard for monitoring our e-commerce platform during Black Friday, focusing on checkout flow metrics, payment processing times, database performance, and user experience indicators over the last 24 hours.",
                "Generate a security monitoring notebook showing authentication attempts, failed logins, and suspicious activity patterns across our infrastructure for the past week, including geolocation analysis and threat indicators."
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById('description').value = randomExample;
            document.getElementById('charCount').textContent = randomExample.length;
        }

        // Enhanced form validation
        function setupFormValidation() {
            const form = document.getElementById('notebookForm');
            const descriptionInput = document.getElementById('description');
            
            descriptionInput.addEventListener('blur', function() {
                if (this.value.length < 20) {
                    this.style.borderColor = '#ff5555';
                    showTooltip(this, 'Please provide a more detailed description (at least 20 characters)');
                } else {
                    this.style.borderColor = '#e5e9ec';
                    hideTooltip(this);
                }
            });
        }

        // Tooltip helpers
        function showTooltip(element, message) {
            // Simple tooltip implementation
            const tooltip = document.createElement('div');
            tooltip.className = 'validation-tooltip';
            tooltip.textContent = message;
            tooltip.style.cssText = `
                position: absolute;
                background: #ff5555;
                color: white;
                padding: 0.5rem;
                border-radius: 4px;
                font-size: 0.75rem;
                margin-top: 0.25rem;
                z-index: 1000;
            `;
            element.parentNode.appendChild(tooltip);
        }

        function hideTooltip(element) {
            const tooltip = element.parentNode.querySelector('.validation-tooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }

        // Enhance the existing handleGenerationSuccess function to add Live Preview button
        const originalHandleGenerationSuccess = window.handleGenerationSuccess;
        
        window.handleGenerationSuccess = function(result, mode = 'notebook') {
            // Call the original function if it exists
            if (originalHandleGenerationSuccess) {
                originalHandleGenerationSuccess(result, mode);
            }
            
            // Add Live Preview button for notebooks only
            if (mode === 'notebook' && result.notebook_json) {
                setTimeout(() => {
                    const resultsActions = document.querySelector('.results-actions');
                    if (resultsActions) {
                        // Check if Live Preview button already exists
                        const existingBtn = resultsActions.querySelector('.live-preview-btn');
                        if (!existingBtn) {
                            const previewBtn = document.createElement('button');
                            previewBtn.className = 'btn btn-small btn-primary live-preview-btn';
                            previewBtn.innerHTML = `
                                <span class="btn-icon">üëÅÔ∏è</span>
                                Live Preview
                            `;
                            previewBtn.onclick = () => showLivePreview(result.notebook_json);
                            resultsActions.insertBefore(previewBtn, resultsActions.firstChild);
                        }
                    }
                    
                    // Also add a floating action button
                    addFloatingPreviewButton(result.notebook_json);
                    
                    // Show preview automatically if enabled
                    if (localStorage.getItem('autoShowPreview') === 'true') {
                        setTimeout(() => showLivePreview(result.notebook_json), 1000);
                    }
                }, 100);
            }
        };
        
        // TypeRacer Modal Game Logic
        let modalCurrentSentence = "The quick brown fox jumps over the lazy dog.";
        let modalCurrentPosition = 0;
        let modalStartTime = null;
        let modalGameCompleted = false;
        let modalCorrectChars = 0;

        const modalSentences = [
            "The quick brown fox jumps over the lazy dog.",
            "Pack my box with five dozen liquor jugs.",
            "How vexingly quick daft zebras jump!",
            "Bright vixens jump; dozy fowl quack.",
            "Sphinx of black quartz, judge my vow.",
            "Two driven jocks help fax my big quiz.",
            "Quick zephyrs blow, vexing daft Jim.",
            "Waltz, bad nymph, for quick jigs vex.",
            "Glib jocks quiz nymph to vex dwarf.",
            "Jackdaws love my big sphinx of quartz."
        ];

        function initModalTypeRacer() {
            modalCurrentSentence = modalSentences[Math.floor(Math.random() * modalSentences.length)];
            modalCurrentPosition = 0;
            modalStartTime = null;
            modalGameCompleted = false;
            modalCorrectChars = 0;
            
            setupModalSentenceHighlighting();
            const modalInput = document.getElementById('modalTypingInput');
            if (modalInput) {
                modalInput.value = '';
                modalInput.disabled = false;
            }
            
            const modalCar = document.getElementById('modalCar');
            if (modalCar) modalCar.style.left = '0%';
            
            const modalWpm = document.getElementById('modalWpm');
            if (modalWpm) modalWpm.textContent = '0';
            
            const modalProgress = document.getElementById('modalProgress');
            if (modalProgress) modalProgress.textContent = '0%';
            
            const modalCompletion = document.getElementById('modalCompletionMessage');
            if (modalCompletion) modalCompletion.style.display = 'none';
        }

        function setupModalSentenceHighlighting() {
            const modalSentenceEl = document.getElementById('modalSentence');
            if (!modalSentenceEl) return;
            
            modalSentenceEl.innerHTML = '';
            for (let i = 0; i < modalCurrentSentence.length; i++) {
                const span = document.createElement('span');
                span.className = 'char';
                span.textContent = modalCurrentSentence[i];
                if (i === 0) {
                    span.classList.add('current');
                }
                modalSentenceEl.appendChild(span);
            }
        }

        function setupModalTypeRacerListeners() {
            const modalInput = document.getElementById('modalTypingInput');
            if (!modalInput) return;
            
            modalInput.addEventListener('input', function(e) {
                if (modalGameCompleted) return;
                
                if (modalStartTime === null) {
                    modalStartTime = Date.now();
                }
                
                const typedText = e.target.value;
                const chars = document.querySelectorAll('.char');
                
                // Reset all character classes
                chars.forEach((char, index) => {
                    char.className = 'char';
                });
                
                // Update character highlighting
                for (let i = 0; i < Math.min(typedText.length, modalCurrentSentence.length); i++) {
                    if (typedText[i] === modalCurrentSentence[i]) {
                        chars[i].classList.add('correct');
                        modalCorrectChars = i + 1;
                    } else {
                        chars[i].classList.add('incorrect');
                        modalCorrectChars = i;
                        break;
                    }
                }
                
                // Highlight current character
                if (typedText.length < modalCurrentSentence.length) {
                    chars[typedText.length].classList.add('current');
                }
                
                const progress = (modalCorrectChars / modalCurrentSentence.length) * 100;
                const modalCar = document.getElementById('modalCar');
                if (modalCar) modalCar.style.left = `${Math.min(progress, 90)}%`;
                
                const modalProgress = document.getElementById('modalProgress');
                if (modalProgress) modalProgress.textContent = `${Math.round(progress)}%`;
                
                updateModalWPM();
                
                if (typedText === modalCurrentSentence) {
                    completeModalGame();
                }
            });
        }

        function updateModalWPM() {
            if (modalStartTime === null) return;
            
            const currentTime = Date.now();
            const timeElapsed = (currentTime - modalStartTime) / 1000 / 60;
            const wordsTyped = modalCorrectChars / 5;
            const wpm = Math.round(wordsTyped / timeElapsed);
            
            const modalWpm = document.getElementById('modalWpm');
            if (modalWpm) modalWpm.textContent = isFinite(wpm) ? wpm : 0;
        }

        function completeModalGame() {
            modalGameCompleted = true;
            const modalInput = document.getElementById('modalTypingInput');
            if (modalInput) modalInput.disabled = true;
            
            const modalCar = document.getElementById('modalCar');
            if (modalCar) modalCar.style.left = '90%';
            
            const modalFinalWpm = document.getElementById('modalFinalWpm');
            const modalWpm = document.getElementById('modalWpm');
            if (modalFinalWpm && modalWpm) {
                modalFinalWpm.textContent = modalWpm.textContent;
            }
            
            const modalCompletion = document.getElementById('modalCompletionMessage');
            if (modalCompletion) modalCompletion.style.display = 'block';
            
            createModalConfetti();
        }

        function createModalConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.width = '8px';
                    confetti.style.height = '8px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
                    confetti.style.zIndex = '10000';
                    confetti.style.borderRadius = '50%';
                    confetti.style.pointerEvents = 'none';
                    
                    document.body.appendChild(confetti);
                    
                    const animation = confetti.animate([
                        { transform: 'translateY(0px) rotate(0deg)', opacity: 1 },
                        { transform: 'translateY(' + (window.innerHeight + 100) + 'px) rotate(720deg)', opacity: 0 }
                    ], {
                        duration: 2000,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    });
                    
                    animation.onfinish = () => {
                        confetti.remove();
                    };
                }, i * 30);
            }
        }

        function resetModalTypeRacer() {
            initModalTypeRacer();
            setupModalTypeRacerListeners();
        }

        // Initialize TypeRacer when loading overlay is shown
        const originalShowLoading = window.showLoading;
        window.showLoading = function(show) {
            if (originalShowLoading) {
                originalShowLoading(show);
            } else {
                // Fallback if original function doesn't exist
                const loadingOverlay = document.getElementById('loadingOverlay');
                const generateBtn = document.getElementById('generateBtn');
                if (show) {
                    if (loadingOverlay) loadingOverlay.style.display = 'flex';
                    if (generateBtn) {
                        generateBtn.disabled = true;
                        generateBtn.innerHTML = '<span class="btn-icon">‚è≥</span>Generating...';
                    }
                } else {
                    if (loadingOverlay) loadingOverlay.style.display = 'none';
                    if (generateBtn) {
                        generateBtn.disabled = false;
                        generateBtn.innerHTML = '<span class="btn-icon">üöÄ</span>Generate Notebook';
                    }
                }
            }
            
            if (show) {
                // Initialize TypeRacer when loading starts
                setTimeout(() => {
                    initModalTypeRacer();
                    setupModalTypeRacerListeners();
                }, 500);
            }
        };

        // Add floating preview button
        function addFloatingPreviewButton(notebookData) {
            // Remove existing floating button
            const existingFloating = document.querySelector('.floating-preview-btn');
            if (existingFloating) {
                existingFloating.remove();
            }
            
            const floatingBtn = document.createElement('div');
            floatingBtn.className = 'floating-preview-btn';
            floatingBtn.innerHTML = `
                <button class="btn btn-primary" onclick="showLivePreview(window.lastNotebookData)" title="Open Live Preview">
                    <span class="btn-icon">üëÅÔ∏è</span>
                    <span>Live Preview</span>
                </button>
            `;
            floatingBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
                animation: slideInFromRight 0.5s ease-out;
                box-shadow: var(--shadow-xl);
                border-radius: var(--border-radius-lg);
            `;
            
            document.body.appendChild(floatingBtn);
            window.lastNotebookData = notebookData;
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (floatingBtn.parentNode) {
                    floatingBtn.style.animation = 'slideOutToRight 0.5s ease-in';
                    setTimeout(() => floatingBtn.remove(), 500);
                }
            }, 10000);
        }
        
        // Add CSS for floating button animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInFromRight {
                from { transform: translateX(100px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutToRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100px); opacity: 0; }
            }
            
            .floating-preview-btn {
                backdrop-filter: blur(10px);
                background: rgba(255, 255, 255, 0.95);
                border-radius: var(--border-radius-lg);
                padding: var(--space-2);
            }
            
            .floating-preview-btn .btn {
                margin: 0;
                box-shadow: none;
            }
        `;
        document.head.appendChild(style);
        
        // Make resetModalTypeRacer globally available
        window.resetModalTypeRacer = resetModalTypeRacer;
    </script>
</body>
</html> 